<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bảng A B C</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  thead th { position: sticky; top: 0; background: #fff; }
  tbody tr:nth-child(odd) { background: rgba(0,0,0,0.02); }
</style>
</head>
<body class="bg-gray-50 text-gray-900 p-4">
<h1 class="text-xl font-bold mb-4">Bảng dữ liệu A B C</h1>
<div id="tableWrap" class="overflow-auto rounded-lg shadow bg-white"></div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRIeBkoyDAioUb9yjM-qqzXBWldNKU7RqXgwVId4cNY_FD3MWwNcE9KZTVYeOncYYRBhWZ8UgQbxCHZ/pub?gid=481463274&single=true&output=csv";

function parseCSV(str) {
  const rows = [];
  let inQuotes = false, field = '', row = [];
  for (let i = 0; i < str.length; i++) {
    const c = str[i];
    if (inQuotes) {
      if (c === '"' && str[i+1] === '"') { field += '"'; i++; }
      else if (c === '"') inQuotes = false;
      else field += c;
    } else {
      if (c === '"') inQuotes = true;
      else if (c === ',') { row.push(field); field = ''; }
      else if (c === '\n') { row.push(field); rows.push(row); row = []; field = ''; }
      else field += c;
    }
  }
  if (field) row.push(field);
  if (row.length) rows.push(row);
  return rows;
}

function renderTable(data) {
  if (!data.length) { 
    document.getElementById('tableWrap').innerHTML = '<div class="p-4">Không có dữ liệu</div>'; 
    return; 
  }
  const header = data[0];
  const idxA = header.indexOf("A");
  const idxB = header.indexOf("B");
  const idxC = header.indexOf("C");
  if (idxA === -1 || idxB === -1 || idxC === -1) {
    document.getElementById('tableWrap').innerHTML = '<div class="p-4 text-red-600">Không tìm thấy cột A, B, C trong dữ liệu</div>';
    return;
  }
  let html = '<table class="min-w-full text-sm"><thead><tr>' +
    ['A','B','C'].map(c => `<th class="px-3 py-2 border-b">${c}</th>`).join('') +
    '</tr></thead><tbody>';
  for (let i = 1; i < data.length; i++) {
    html += '<tr class="hover:bg-indigo-50/40">' +
      `<td class="px-3 py-2 border-b">${data[i][idxA] || ''}</td>` +
      `<td class="px-3 py-2 border-b">${data[i][idxB] || ''}</td>` +
      `<td class="px-3 py-2 border-b">${data[i][idxC] || ''}</td>` +
      '</tr>';
  }
  html += '</tbody></table>';
  document.getElementById('tableWrap').innerHTML = html;
}

fetch(CSV_URL).then(r => {
  if (!r.ok) throw new Error("Không tải được CSV");
  return r.text();
}).then(txt => {
  const data = parseCSV(txt);
  renderTable(data);
}).catch(err => {
  document.getElementById('tableWrap').innerHTML = `<div class="p-4 text-red-600">Lỗi: ${err.message}</div>`;
});
</script>
</body>
</html>
